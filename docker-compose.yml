services:
  qdrant:
    image: qdrant/qdrant
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    environment:
      - QDRANT__SERVICE__HTTP_PORT=6333

  ml-service:
    build: .
    ports:
      - "8001:8001"
    depends_on:
      - qdrant
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - TRANSFORMERS_CACHE=/home/app/.cache/huggingface
      - TORCH_HOME=/home/app/.cache/torch
    volumes:
      - ./ml-service:/app/ml-service
      - ./shared:/app/shared
      - model_cache:/home/app/.cache/huggingface
    restart: unless-stopped

volumes:
  qdrant_data:
  model_cache: